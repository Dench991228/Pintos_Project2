# 关于用户内存访问问题
## 系统需求
- 系统调用的时候,不能有"问题指针"
- 问题指针包括如下内容
    - 空指针
    - 没有被映射的虚拟地址
    - 指向内核空间的虚拟地址
- 遇到"问题指针"怎么办:消灭这个进程
## 解决方案
- 先验证一下这个传进来的指针有没有啥问题,然后再使用它
- 参考内容:
    - threads/vaddr.h:is_user_vaddr,is_kernel_vaddr
    - userprog/pagedir.c:
# 系统调用问题
- 如何传递参数:
    - 通过handler中的intr_frame传递
        - 编号:esp指向的数
        - 参数:esp之上的各种数
## Exit调用
### 不考虑非法退出的情况
1. 把eax设定为返回值
2. thread_exit()即可
### 考虑非法退出
#### 数据结构改变
- thread:添加ret用来保存返回值,必须是整数
#### 具体步骤
1. 从intr_frame中获取返回值
2. 把这个值放到当前线程的ret中
3. 正常退出,所以eax是0
4. thread_exit()
